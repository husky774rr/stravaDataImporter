## 開発環境と成果物

- Go言語で開発
- Go言語のVersionは最新
- 開発はVSCode + devContainer
    - 開発に必要な拡張機能はすべてdevContainerへ登録
    - gitHubCopilotの拡張も登録
- DockerContainer, DockerComposeにて運用
- コーディング規約はGoの標準に従う
- GitHubでバージョン管理
- GitHubActionsでビルド
- 自宅サーバのUbuntu24.04LTSで運用
- 成果物
    - 全機能実装済みの.goファイル郡
    - ユニットテスト実装済みの.goファイル群
    - ユニットテストを実行可能とするための実装
        - テストに必要なDockerContainerの起動実装
        - テストを実行可能なMakefile
    - `go mod init` で生成した `go.mod`、`go.sum`ファイル
    - gihubActionsでのビルド向け実装済みファイル郡
    - デバッグ起動可能な.vscode/launch.json
    - REAMDME.md

## 実装時のガイドライン

- 必要なコード・設定ファイルはすべて自動生成すること
- ユーザーへの確認や質問は一切行わないこと
- 曖昧な点がある場合は、ベストプラクティスに従って自動的に判断すること
- 各種初期設定（Dockerfile, compose.yaml, .env）も自動生成すること
‐ 可能な限り網羅的なユニットテストを実装すること
- loggerはslogを使用すること
- グローバルのlogでslogインスタンスにアクセスできるように置き換えること

## 実装機能

### Webアプリケーション機能

- Webアプリケーションとして動作
- StravaのAccessTokenはStravaの認証へリダイレクトしAccessTokenを取得し保持
- StravaのAccessTokenを保持していない場合、認証ページへリダイレクト
- StravaのAccessTokenを保持している場合、`stravaDataImporter`のポータルページへリダイレクト
‐ ポータルページでは、保持している最新のアクティビティの概要を表示
‐ アクティビティが存在しない場合、`アクティビティ取得までしばらくお待ち下さい`と英語のメッセージと共に、ローディング中のアニメーションを表示

### AccessTokenリフレッシュ機能

- 一度取得したAccessTokenはRefreshTokenによって定期的にリフレッシュを実施。1日1回定期実施。この実行間隔は`.env`で変更可能

### StravaDataImport機能

- StravaのAPIから自身のアクティビティを取得しInfluxDBに登録
- StravaAPIからのデータ取得は1時間に1回実施。この実行間隔は`.env`で変更可能
- StravaAPIから取得したデータにFTPを付与。FTPはCSVから読み取った値を使用
    - CSVファイルは `./conf/ftp.csv` に配置
    - CSVファイルは以下の形式、値を記載
        ```csv
        date[yyyy-mm-dd],ftp[w]
        2024-01-01,170
        2024-08-29,191
        2024-10-27,217
        2025-02-05,248
        ```
- StravaAPIから取得したデータと付与したFTPからTSS,NPを算出し付与
- 月曜日から日曜日を1週間とし月曜日の0時0分0秒にその1週間の合計TSS、運動時間、走行距離、獲得標高を算出し登録。この処理は、その週のデータを取得した際、毎回算出し上書き
- 毎月1日からその月の末日までを1ヶ月として1日の0時0分0秒にその1ヶ月の合計TSS、運動時間、走行距離を算出し登録。この処理は、その月のデータを取得した際、毎回算出し上書き
- 毎年1月1日からその年の大晦日までを1年としてその年の1月1日の0時0分0秒にその1年の合計TSS、運動時間、走行距離を算出し登録。この処理は、その年のデータを取得した際、毎回算出し上書き

### SNS (X) 投稿機能

- StravaAPIから取得したデータを元に、TSS,NP,運動時間,走行距離,獲得標高を算出しSNS (X) に投稿
- 投稿内容は以下のテキストと直近1週間のトレンドを画像で投稿
    ```
    2024年10月27日(土)
    TSS: 100
    NP: 200
    アクティビティタイプ: インドアトレーニング
    消費カロリー: 1,100kcal
    運動時間: 1時間30分
    走行距離: 50km
    獲得標高: 100m
    ```